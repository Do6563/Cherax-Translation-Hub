name: Auto Increment Version (JSON)

# Translations 폴더 안의 .json 파일이 변경될 때 실행
on:
  push:
    branches:
      - main
    paths:
      - 'Translations/*.json' 

jobs:
  bump-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Read and Increment Version
        run: |
          if [ ! -f version.txt ]; then echo "0" > version.txt; fi
          CURRENT_VERSION=$(cat version.txt | xargs)
          if ! [[ "$CURRENT_VERSION" =~ ^[0-9]+$ ]]; then CURRENT_VERSION=0; fi
          NEW_VERSION=$((CURRENT_VERSION + 1))
          echo "$NEW_VERSION" > version.txt
          echo "Translation Updated! Bumping version to $NEW_VERSION"

      - name: Commit and Push changes
        run: |
          git config --global user.name "CheraxAutoBot"
          git config --global user.email "actions@github.com"
          git add version.txt
          git commit -m "Auto-bump version to $(cat version.txt) [skip ci]"
          git push
